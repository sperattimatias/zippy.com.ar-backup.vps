name: production-env-validation

on:
  workflow_dispatch:
  workflow_call:

jobs:
  validate-env:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Validate deployment environment
        run: node scripts/ci/validate-production-env.mjs
        env:
          TRAEFIK_DOMAIN: ${{ secrets.TRAEFIK_DOMAIN }}
          ACME_EMAIL: ${{ secrets.ACME_EMAIL }}
          CF_DNS_API_TOKEN: ${{ secrets.CF_DNS_API_TOKEN }}
          NODE_ENV: production
          LOG_LEVEL: ${{ secrets.LOG_LEVEL }}
          POSTGRES_USER: ${{ secrets.POSTGRES_USER }}
          POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}
          POSTGRES_DB: ${{ secrets.POSTGRES_DB }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          REDIS_URL: ${{ secrets.REDIS_URL }}
          JWT_ACCESS_SECRET: ${{ secrets.JWT_ACCESS_SECRET }}
          JWT_ACCESS_EXPIRES_IN: ${{ secrets.JWT_ACCESS_EXPIRES_IN }}
          REFRESH_TOKEN_EXPIRES_DAYS: ${{ secrets.REFRESH_TOKEN_EXPIRES_DAYS }}
          EMAIL_VERIFICATION_TTL_MIN: ${{ secrets.EMAIL_VERIFICATION_TTL_MIN }}
          MINIO_ENDPOINT: ${{ secrets.MINIO_ENDPOINT }}
          MINIO_PORT: ${{ secrets.MINIO_PORT }}
          MINIO_ROOT_USER: ${{ secrets.MINIO_ROOT_USER }}
          MINIO_ROOT_PASSWORD: ${{ secrets.MINIO_ROOT_PASSWORD }}
          MINIO_BUCKET: ${{ secrets.MINIO_BUCKET }}
